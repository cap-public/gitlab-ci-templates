include:
  - template: Code-Quality.gitlab-ci.yml

code_quality:
  stage: check
  # deactivate DinD Service
  services:
  script:
    - docker run
        --tty --rm
        --env SOURCE_CODE="$CI_PROJECT_DIR"
        --env CODECLIMATE_DEBUG=1
        --volume $CI_PROJECT_DIR:/code
        --volume /var/run/docker.sock:/var/run/docker.sock
        "$CODE_QUALITY_IMAGE" /code
  artifacts:
    expose_as: 'Code Quality Report'
    paths: [gl-code-quality-report.json]
  rules:
    - if: '$CODE_QUALITY_DISABLED'
      when: never
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
    - if: '$CI_COMMIT_BRANCH == "master"'
